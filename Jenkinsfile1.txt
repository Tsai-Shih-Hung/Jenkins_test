pipeline{
    agent any

    stages{
        stage('Hello'){
            steps{
                echo 'hello'
            }
        }
		stage('test version'){
            steps{
                sh '''
			    ansible --version
                ls -al
                pwd
    		    '''
            }
        }
        stage('test ping'){
            steps{
                ansiblePlaybook become: true, credentialsId: 'ansible', disableHostKeyChecking: true, installation: 'ansible', inventory: 'inventory', playbook: 'test.yaml'

            }
        }
        stage('new vm'){
            steps{
                ansiblePlaybook become: true, credentialsId: 'ansible', disableHostKeyChecking: true, extras: 'ansible_user=root ansible_password=123456', installation: 'ansible', inventory: 'inventory', playbook: 'addnewuser.yaml'
                echo '192.168.81.135' 
            }
        }
        stage('add inventory'){
            steps{
                echo '192.168.81.135' >> inventory
                cat inventory
            }
        }
        stage('check result'){
            steps{
               sh'''
                ansible-playbook webservers -m ping
               '''
            }
        }
    }
}